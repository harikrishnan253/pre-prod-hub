{% extends "base.html" %}

{% block title %}Validation Results{% endblock %}

{% block content %}
<div class="results-container">
    <h2>Validation Results for {{ filename }}</h2>

    <div class="results-summary">
        <div class="summary-card">
            <h3>Total References</h3>
            <div class="summary-value">{{ results.total_references }}</div>
        </div>
        <div class="summary-card">
            <h3>Total Citations</h3>
            <div class="summary-value">{{ results.total_citations }}</div>
        </div>
        <div class="summary-card">
            <h3>Missing References</h3>
            <div class="summary-value">{{ results.missing_references|length }}</div>
        </div>
        <div class="summary-card">
            <h3>Unused References</h3>
            <div class="summary-value">{{ results.unused_references|length }}</div>
        </div>
    </div>

    <div class="results-details">
        <div class="detail-section">
            <h3>Missing References (Cited but not in bibliography)</h3>
            {% if results.missing_references %}
                <ul>
                    {% for ref in results.missing_references %}
                        <li>{{ ref }}</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No missing references found.</p>
            {% endif %}
        </div>

        <div class="detail-section">
            <h3>Unused References (In bibliography but not cited)</h3>
            {% if results.unused_references %}
                <ul>
                    {% for ref in results.unused_references %}
                        <li>{{ ref }}</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No unused references found.</p>
            {% endif %}
        </div>

        <div class="detail-section">
            <h3>Citation Sequence Issues</h3>
            {% if results.sequence_issues %}
                {% for issue in results.sequence_issues %}
                    <div class="sequence-issue">
                        <p>At position {{ issue.position }}: {{ issue.current }} appears after {{ issue.previous }}</p>
                    </div>
                {% endfor %}
            {% else %}
                <p>No citation sequence issues found.</p>
            {% endif %}
        </div>
    </div>

    <div class="results-actions">
        <a href="{{ url_for('download_report', filename=report_file) }}" class="btn btn-primary">
            <i class="fas fa-download"></i> Download Full Report
        </a>
        <a href="{{ url_for('upload_file') }}" class="btn">
            <i class="fas fa-upload"></i> Upload Another File
        </a>
    </div>
</div>
{% endblock %}