{% extends "base.html" %}

{% block title %}Dashboard - S4carlisle{% endblock %}

{% block content %}
<div class="container animate-fade-up">
    <!-- Welcome Section -->
    <div class="mb-4">
        <h1 class="text-gradient" style="font-size: 2.5rem; margin-bottom: 0.5rem;">Welcome back, {{ session['username']
            }}!</h1>
        <p style="color: #6b7280; font-size: 1.1rem;">Here's what's happening with your projects today.</p>
    </div>

    <!-- Admin Stats (Conditional) -->
    {% if admin_stats %}
    <div class="glass-card mb-4 animate-fade-up delay-100">
        <div class="d-flex justify-between align-center mb-3">
            <h2 style="margin:0; font-size: 1.5rem;">System Overview</h2>
            <span class="badge badge-primary">Admin View</span>
        </div>
        <div class="stats-grid">
            <div class="text-center">
                <div class="stat-value">{{ admin_stats.total_users }}</div>
                <div class="stat-label">Total Users</div>
            </div>
            <div class="text-center">
                <div class="stat-value">{{ admin_stats.total_files }}</div>
                <div class="stat-label">Total Files</div>
            </div>
            <div class="text-center">
                <div class="stat-value">{{ admin_stats.total_validations }}</div>
                <div class="stat-label">Validations</div>
            </div>
            <div class="text-center">
                <div class="stat-value">{{ admin_stats.total_macro }}</div>
                <div class="stat-label">Macro Processes</div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Quick Actions Grid -->
    <h2 class="mb-3 animate-fade-up delay-200">Quick Actions</h2>
    <div class="quick-actions-grid animate-fade-up delay-200">
        <!-- Validation -->
        {% if current_role in ['COPYEDIT', 'ADMIN'] %}
        <a href="{{ url_for('validation.validate_file') }}" class="glass-card action-card">
            <div class="action-icon-large">
                <i class="fas fa-check-circle"></i>
            </div>
            <h3 class="action-title">Validate References</h3>
            <p class="action-desc">Check reference consistency and citations automatically.</p>
        </a>
        {% endif %}

        <!-- Pre-Editing -->
        {% if current_role in ['COPYEDIT', 'ADMIN'] %}
        <a href="{{ url_for('macros.macro_processing') }}" class="glass-card action-card">
            <div class="action-icon-large">
                <i class="fas fa-cogs"></i>
            </div>
            <h3 class="action-title">Pre-Editing</h3>
            <p class="action-desc">Apply standard pre-editing rules to your documents.</p>
        </a>
        {% endif %}

        <!-- Technical Editing -->
        {% if current_role in ['COPYEDIT', 'ADMIN'] %}
        <a href="{{ url_for('macros.technical') }}" class="glass-card action-card">
            <div class="action-icon-large">
                <i class="fas fa-tools"></i>
            </div>
            <h3 class="action-title">Technical Editing</h3>
            <p class="action-desc">Process documents with technical editing guidelines.</p>
        </a>
        {% endif %}

        <!-- Language Editing -->
        {% if current_role in ['COPYEDIT', 'ADMIN'] %}
        <a href="{{ url_for('macros.language') }}" class="glass-card action-card">
            <div class="action-icon-large">
                <i class="fas fa-language"></i>
            </div>
            <h3 class="action-title">Language Editing</h3>
            <p class="action-desc">Enhance language quality and consistency.</p>
        </a>
        {% endif %}

        <!-- PPD Processing -->
        {% if current_role in ['PPD', 'ADMIN'] %}
        <a href="{{ url_for('ppd.ppd_route') }}" class="glass-card action-card">
            <div class="action-icon-large">
                <i class="fas fa-magic"></i>
            </div>
            <h3 class="action-title">PPD Processing</h3>
            <p class="action-desc">Finalize deliverables for publishing.</p>
        </a>
        {% endif %}
    </div>

    <!-- Recent Activity Section -->
    <div class="glass-card animate-fade-up delay-300">
        <div class="d-flex justify-between align-center mb-3">
            <h2>Recent Files</h2>
            <a href="{{ url_for('main.file_history') }}" class="btn btn-outline">
                View All History <i class="fas fa-arrow-right" style="margin-left: 5px;"></i>
            </a>
        </div>

        {% if recent_files %}
        <table class="glass-table">
            <thead>
                <tr>
                    <th>Filename</th>
                    <th>Uploaded</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for file in recent_files %}
                <tr>
                    <td>
                        <div class="d-flex align-center gap-2">
                            <i class="fas fa-file-word text-primary"></i>
                            <strong>{{ file.original_filename }}</strong>
                        </div>
                    </td>
                    <td>{{ file.upload_date }}</td>
                    <td>
                        {% if file.report_filename %}
                        <a href="{{ url_for('main.download_report', filename=file.report_filename) }}"
                            class="btn btn-primary" style="padding: 0.4rem 0.8rem; font-size: 0.85rem;">
                            Download Report
                        </a>
                        {% else %}
                        <span class="text-muted">No report</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="text-center p-5">
            <i class="fas fa-folder-open" style="font-size: 3rem; color: #cbd5e1; margin-bottom: 1rem;"></i>
            <p class="text-muted">No recent files found.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}